经过初期的技术摸索和依赖对齐，我们现在需要跳出代码细节，从**全局视角**重新锚定“水政通 (HydroDoc AI)”的核心逻辑。

目前我们的需求已经从一个模糊的构想，进化为一个**基于 AI Agent 架构的垂直行业解决方案**。

---

## 🎨 1. 项目愿景与核心价值

**项目名称：** 水政通 (HydroDoc AI)
**核心定位：** 针对水利系统执法场景，将“碎片化现场证据”转化为“国标规范公文”的 AI 智能体。
**核心价值：** * **合规性：** 解决人工起草公文时法律条文引用过时、错误的问题。

* **专业性：** 自动适配 GB/T 9704 国标公文排版，无需人工调整格式。
* **透明性：** 通过 LangGraph 记录 AI 的推理与审计过程，确保政务操作可追溯。

---

## ⚙️ 2. 业务功能需求 (MVP 阶段)

### A. 智能起草流 (Smart Drafting)

* **输入：** 支持录入现场违规描述、图片 OCR 文本或初步调查笔录。
* **AI 处理：** 1. **实体提取**：自动识别违规主体、时间、地点、违规行为。
2. **法条关联**：从 RAG 知识库检索对应的《水法》或地方条例。
3. **初稿生成**：生成标准的《限期缴纳通知书》或《行政处罚决定书》草案。

### B. 法律合规审计 (Legal Audit)

* **自动对齐**：AI 检查生成的处罚理由是否在法律赋予的职权范围内。
* **引用核验**：确保引用的法条编号、内容与知识库原文 100% 一致。

### C. 人机协同逻辑 (Human-in-the-loop)

* **状态中断**：当 AI 对处罚力度或法条适用存在争议（置信度低）时，自动暂停，等待用户在前端界面通过/修改。
* **断点续传**：用户确认后，Graph 继续运行至导出节点。

### D. 国标排版导出

* **一键导出**：输出 `.docx` 格式，字体（仿宋_GB2312）、字号、行距、页边距严格符合公文要求。

---

## 🛠️ 3. 技术架构需求 (架构图)

* **后端 (Backend)**：
* **LangGraph.js**: 负责有状态的流程控制（起草 -> 审计 -> 修正 -> 导出）。
* **RAG Engine**: 基于本地向量存储 (如 ChromaDB/SQLite) 的法律法规检索。
* **SSE Server**: 向前端实时推送 Agent 执行进度。


* **前端 (Frontend)**：
* **Next.js 16**: 提供沉浸式编辑器和实时流式视图。
* **SSE Client**: 实时渲染 AI 的“思考过程”节点。


* **共享层 (Shared)**：
* 统一的 TypeScript 类型定义，确保数据在前后端传输中不丢失字段。



---

## 📊 4. 实施策略需求

1. **Vibe Coding 开发模式**：
* 依赖 `.cursorrules` 和 `.mdc` 规则集引导 Cursor 自动生成 80% 的样板代码。
* 人工专注于 **Prompt Engineering** 和 **业务逻辑审计**。


2. **部署环境**：
* 初期：MacBook Air M4 本地开发（先使用硅基流动的Qwen/Qwen3-8B,API_KEY在.env中）。
* 远期：支持私有化部署，兼容政务内网环境。



---

## 🗓️ 5. 接下来的 Todo List (按优先级)

* [ ] **1. 共享契约建立**：在 `packages/shared` 定义核心 `State` 接口（**这是下一轮对话的触发点**）。
* [ ] **2. 法律库知识化**：在 `data/law-library` 放入首批 PDF，并让 Cursor 编写 RAG 处理脚本。
* [ ] **3. 图逻辑骨架**：在后端实现一个包含 4 个基本节点的 LangGraph 状态机。
* [ ] **4. 渲染打样**：编写第一个能输出“仿宋_GB2312”字体的 Word 导出函数。

---
